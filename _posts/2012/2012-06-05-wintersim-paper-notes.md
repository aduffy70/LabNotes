---
title: WInterSim paper notes
date: 2012-06-05T23:59:11+00:00
layout: post
categories:

---
Transferred from other note files to lab records (better late than never!)

**Notes and draft text (some sections were not used in the final draft and may be useful later):**

Comments on Fernland scale:

For example, the Virtual Fernland uses a set of five domain specific simulation modules and up to 25000 scripted objects.  The scripted objects, which represent individual fern plants, implement the simulated genetic model through a combination of hard-coded and user configurable parameters.  They interact with each other, with the simulation modules, and with users within the VE.  The simulation modules generate and manipulate the plants, provide a user interface for configuring the simulation, track and report statistics on the simulation status, and provide virtual habitat variation.

Figure caption:

Figure XX: Virtual Fernland integration with OpenSim

Review of Virtual Fernland, how the content was created, and the cost:

Virtual Fernland was developed by a biologist to provide a highly visual model of gene flow in fern populations and to teach principles of population genetics theory through hands-on inquiry activities.  The system simulates a population of virtual ferns that evolves over time in response to natural selection, random genetic drift, migration, and non-random mating.

The Virtual Fernland implementation is pictured in Figure XX.  As each individual scripted plant is generated by a simulation module, it is provided with a virtual genome 'inherited' from its parents (or from a scripted fern planter when the user initiates the simulation).  The plant receives information about the current environment at its location from shared modules (light, wind, cloud cover, presence of neighbors) and from a simulation-specific module (soil conditions).  Another simulaton-specific module provides the plant with user configuration information.  Users interface with the module through webforms to configure several traits that control how well the plant thrives and reproduces and whether each trait is affected by the plant's genome.  The plant uses all of this information to simulate growth, reproduction and eventually death.  Over time, plants with genetic traits that are adapted to the environment live longer and reproduce more often, so the genes controlling those traits become more common in the population.  Because the environment varies in both time and space, complex patterns develop across the virtual landscape.  Users are able to visualize these patterns in several ways through a simulation-specific module that modifies the appearance of the plants based on their genome.  Another simulation module tracks, logs and plots (on a webpage) data on the population size and genetic makeup.  The module also provides data summaries to scripted Heads Up Displays worn by each users' avatar.

A similar and closely related Virtual Plant Community simulator (VPCsim) was also developed to teach inquiry-based science to eighth grade students.  VPCsim will be described in detail elsewhere (Duffy et al, in prep) but is mentioned briefly here as an example of specific challenges that arise under today's content creation paradigm (Fig 2a).

Like Virtual Fernland, VPCsim uses individual plants that interact with each other and with simulation modules that control the virtual habitat and report on simulation status.  However, VPCsim simulates a multi-species ecological competition model rather than a population genetics model.  Even though the two simulation systems share the same basic structure and requirements, very little of the existing Virtual Fernland code could be repurposed leading to hundreds of hours of duplicated effort.  Implementing any other plant interaction models would require that development process to be repeated yet again.  In fact, even transferring the ecological simulation from OpenSimulator to a different 3D virtual environment (Unity3D) required rewriting most of the scripts and modules, since they interact directly with features of the VE that are platform specific.

For example, the developers of Virtual Fernland also created another simulation (to be described in detail elsewhere) to teach plant community ecology.  Like VIrtual Fernland, this simulation uses individual plant objects that interact with simulation modules that control the virtual habitat, provide a user interface, and report on simulation status.  However, even though the two systems share a similar structure and requirements, very little of the existing Fernland code could be reused, leading to many hours of duplicated effort.

... closely related Virtual Plant Community simulator (VPCsim) to teach ecology and science inquiry to eighth grade students.  VPCsim will be described in detail elsewhere (Duffy et al, in prep) but is mentioned here as an example of specific challenges of “developing every time” (Fig 2a).

Like Virtual Fernland, VPCsim uses individual plant objects that interact with simulation modules that control the virtual habitat, provide a user interface, and report on simulation status.  However, VPCsim simulates a very different biological model.  Even though the two systems share the same basic structure and requirements, because Virtual Fernland was not created using shareable libraries or reusable toolstacks, very little of the existing code could be repurposed, leading to hundreds of hours of duplicated effort.  Implementing any other plant interaction models or simulations of other organism types would require that development process to be repeated yet again.  In fact, even transferring the ecological simulation from OpenSimulator to a different 3D virtual environment (Unity3D) required rewriting most of the scripts and modules, since they interact directly with features of the VE that are platform specific.

For instance, sorting is a common operation in data analysis applications. The basic reproductive, competitive, and environmental interactions that drive simulations of fern genetics could are similar to the interactions at work in other organisms.  Also, the tools which summarize and plot information about a population of virtual ferns could be generalized to analyze data describing many other types of virtual objects.

Each of the simulation modules used in Virtual Fernland could be made more generally applicable and published as reusable libraries.  For example, the Parameters module reads a set of fern-specific genetic and life history parameters and provides those parameters to each new fern object so users can change simulation parameters before (or even during) the simulation.  The module is currently hard-coded to handle a specific set of parameters in a specific order, stored in an unannotated text file.  With the ModInvoke system now available in OpenSimulator, the module could make use of the data exchange interface to pass any set of parameters required by any virtual organism, rather than being limited to the set of fern-specific parameters.  New virtual organisms could request the appropriate parameters through the control interface and register to be notified by the event service when a parameter is changed.

Similar changes could be made to the other Virtual Fernland modules, providing generic modules for summarizing and plotting data about virtual objects, modifying features of a virtual habitat, and visualizing genetics of virtual organisms across a landscape.  These more generalized versions of the modules could have drastically reduced the time and effort required to create VPCsim and would allow easier experimentation with a variety of biological simulations.

However, even these changes would not address the biggest limitation of the current implementation of Virtual Fernland: the simulation is driven by the interactions of thousands of individually scripted fern objects.  Using large numbers of scripted objects pushes the limits of the scripting engine and makes it difficult to modify to plant behavior or to create new types of virtual organisms.  To convert Virtual Fernland into a set of reusable tools for creating virtual genetic simulations, it would need to be re-architected.   Followinging the 'active content' design pattern, the system could be configured (similarly to the QuickSort system) so we could:

Define an evolution space, where any object we place in the space becomes a virtual organism.

Configure the organism behavior with scripts to define the lifecycle genetics, and interactions of each type of organism.

Drop objects into the evolution space and allow them to begin reproducing and interacting with each other.

The Soil module was the only Virtual Fernland module reused in VPCsim without modification, but it could still be improved and converted to be more broadly applicable.  Incorporating the ModInvoke functions now available in OpenSim would eliminate the need to apply patches to OpenSimulator's scripting engine.  Furthermore, the module could be generalized to provide support for any number of habitat parameters that vary across a virtual landscape, rather than being hard-coded to control three specific soil parameters.

The Visualization module, which highlights specific ferns by changing their color and size based on information stored in the names and descriptions of virtual fern objects could be generalized to highlight other types of virtual objects based on other characteristics.

Similarly, the Summary module could provide summary statistics for other types of virtual objects.  The version of this module used in VPCsim has already been made more generally applicable by replacing the perl script that generated the summary plots with a flexible plotting library (dygraphs).

The Parameters module reads a set of fern-specific genetic and life history parameters and provides those parameters to each new fern object so users can change simulation parameters before (or even during) the simulation.  The module is hard-coded to expect a specific set of parameters in a specific order, stored in an unannotated text file.  A webform is used to generate the text file to reduce human error.  Moving to a system using a domain-specific language would allow the module to communicate with virtual organisms requiring a different set of parameters, without having to recode the module for each new organism type.  Also, storing the parameters in a more human-friendly format would increase flexibility by allowing users to manually generate the files, rather than relying on a webform hardcoded with particular parameters.

The Manager module, which currently is hardcoded to generate and track only fern objects and a fern planter, could be modified to handle other types of objects or even more than one type of object at once (as is required by VPCsim).  This module also contains several functions that could be useful in other projects if they were separated out into separate shared libraries, such as an interface to allow users to select from among a set of preloaded virtual terrains.

If these more generalized versions of the modules had been available, creating VPCsim would have been much faster.  This flexible set of modules would drastically decrease the time required to generate a wide variety of biological simulations.

Author bio:

AARON M. DUFFY is a PhD student in the Department of Biology at Utah State University.  His research interests include plant genomics, population genetics of ferns with atypical lifecycles and teaching scientific concepts and science inquiry through interactive simulations.  His email address is aaron.duffy@usu.edu.
